# SONGLY - Инструкция по установке админ-панели

## Требования
- PHP 7.4 или выше
- MySQL 5.7 или выше
- Web-сервер (Apache/Nginx или встроенный сервер PHP)

## Установка

### 1. Импорт базы данных

Выполните SQL миграцию для добавления админ-панели:

```bash
mysql -u root -p songsbook < database_migration.sql
```

Или через phpMyAdmin:
1. Откройте phpMyAdmin
2. Выберите базу данных `songsbook`
3. Перейдите на вкладку "SQL"
4. Скопируйте и выполните содержимое файла `database_migration.sql`

### 2. Проверка конфигурации

Убедитесь, что параметры подключения к БД в файле `config/db_config.php` корректны:

```php
define('DB_SERVER', 'localhost');
define('DB_USERNAME', 'root');
define('DB_PASSWORD', '');
define('DB_NAME', 'songsbook');
```

### 3. Проверка прав доступа

Убедитесь, что папки для изображений имеют права на запись:

```bash
chmod -R 755 images/
chmod -R 755 images/singer/
chmod -R 755 images/song/
chmod -R 755 images/album/
```

## Первый вход в админ-панель

После выполнения миграции автоматически создается администратор:

- **URL**: `http://ваш-домен/admin/admin_login.php`
- **Логин**: `admin`
- **Пароль**: `admin123`

⚠️ **ВАЖНО**: После первого входа настоятельно рекомендуется сменить пароль!

## Запуск проекта

### Используя встроенный сервер PHP:

```bash
cd /path/to/songsbook_project
php -S localhost:8000
```

Затем откройте в браузере:
- Сайт: `http://localhost:8000/index.html`
- Админка: `http://localhost:8000/admin/admin_login.php`

### Используя MAMP/XAMPP:

1. Поместите проект в папку `htdocs` (XAMPP) или `htdocs` (MAMP)
2. Запустите Apache и MySQL
3. Откройте `http://localhost/songsbook_project/`

## Структура админ-панели

После входа в админ-панель вы получите доступ к:

### Dashboard
- Общая статистика (количество исполнителей, песен, альбомов, текстов)
- Быстрые ссылки на добавление контента

### Управление исполнителями
- Просмотр всех исполнителей
- Добавление нового исполнителя (имя, фото, описание, подписчики, contributions)
- Редактирование существующих исполнителей
- Удаление исполнителей (только если у них нет песен и альбомов)

### Управление песнями
- Просмотр всех песен
- Добавление новой песни (название, исполнитель, обложка, количество прослушиваний)
- Редактирование существующих песен
- Удаление песен

### Управление альбомами
- Просмотр всех альбомов
- Добавление нового альбома (название, исполнитель, обложка, год выпуска)
- Редактирование существующих альбомов
- Удаление альбомов

### Управление текстами песен
- Просмотр всех песен и их текстов
- Добавление текста для песни (текст, producer)
- Редактирование существующих текстов

## Загрузка изображений

При добавлении или редактировании исполнителей, песен и альбомов вы можете загружать изображения:

- **Поддерживаемые форматы**: JPG, JPEG, PNG, GIF
- **Максимальный размер**: 5MB
- **Хранение**: Изображения сохраняются в соответствующих папках (`images/singer/`, `images/song/`, `images/album/`)
- **База данных**: Путь к изображению сохраняется в БД в поле `image_path`

## Безопасность

### Реализованные меры безопасности:
- ✅ Хеширование паролей (password_hash)
- ✅ Prepared statements (защита от SQL-инъекций)
- ✅ XSS защита (htmlspecialchars)
- ✅ Валидация загружаемых файлов
- ✅ Проверка типов и размеров изображений
- ✅ Сессионная аутентификация
- ✅ Автоматический timeout сессии (30 минут)

### Рекомендации:
- ⚠️ Смените стандартный пароль администратора
- ⚠️ Используйте HTTPS в продакшене
- ⚠️ Ограничьте доступ к папке `/admin/` через .htaccess (для Apache)
- ⚠️ Регулярно создавайте резервные копии базы данных

## Создание нового администратора

Чтобы создать дополнительного администратора, выполните SQL запрос:

```sql
-- Сначала сгенерируйте хеш пароля в PHP:
-- password_hash('ваш_пароль', PASSWORD_DEFAULT)

INSERT INTO admin_users (username, password_hash)
VALUES ('новый_логин', 'хеш_пароля');
```

Или создайте PHP скрипт для генерации хеша:

```php
<?php
echo password_hash('мой_новый_пароль', PASSWORD_DEFAULT);
?>
```

## Устранение неполадок

### Ошибка подключения к базе данных
- Проверьте параметры в `config/db_config.php`
- Убедитесь, что MySQL сервер запущен
- Проверьте права пользователя БД

### Не загружаются изображения
- Проверьте права доступа к папкам images/
- Убедитесь, что пути в БД корректны
- Проверьте максимальный размер загружаемых файлов в php.ini

### Сессия постоянно истекает
- Проверьте настройки session в php.ini
- Увеличьте `session.gc_maxlifetime`
- Убедитесь, что папка для сессий доступна для записи

### Ошибка 404 при доступе к админке
- Проверьте, что файлы находятся в папке `/admin/`
- Убедитесь, что сервер правильно обрабатывает PHP файлы
- Проверьте конфигурацию виртуального хоста

## Поддержка

При возникновении проблем проверьте:
1. Логи ошибок PHP
2. Логи MySQL
3. Консоль разработчика в браузере
4. Файл `CLAUDE.md` для дополнительной информации об архитектуре
